# Item 32

## 제네릭과 가변인수를 함께 쓸 때는 신중하라

- 제네릭 가변인수 배열에 값을 저장하는 것은 안전하지 않음
  - Heap pollution 이 발생할 수 있음
    - 컴파일 경고 발생
  - Java 7 에서 추가된 `@SafeVarargs` 어노테이션을 사용할 수 있음
- 제네릭 가변인수 배열의 참조를 밖으로 노출하면 힙 오염이 전달됨
  - 예외적으로, @SafeVarargs 를 사용한 메서드에 넘기는 것은 안전
  - 예외적으로, 배열 내용의 일부 함수를 호출하는 일반 메서드로 넘기는 것은 안전
- Item 28의 조언에 따라 가변인수를 List 로 바꾼다면
  - 배열없이 제네릭만 사용하므로 컴파일러가 타입 안정성을 보장할 수 있음
  - @SafeVarargs 어노테이션을 사용할 필요가 없음
  - 실수로 안전하다고 판단할 걱정이 없음

## 완벽 공략

### ThreadLocal

- 모든 멤버 변수는 기본적으로 여러 쓰레드에서 공유
  - 이때 쓰레드 안정성과 관련된 문제가 발생 가능
  - 경합, 경쟁 조건(Race-Condition)
  - 교착 상태(Deadlock)
  - Livelock
    - 서로 계속 락만 교환하는 상태
- 쓰레드 지역 변수를 사용하면 동기화를 사용하지 않아도 한 쓰레드에만 접근 가능하기에 안전하게 사용 가능
- 한 쓰레드 내에서 공유하는 데이터로 메서드 매개변수에 매번 전달하지 않고 전역 변수처럼 사용 가능

### ThreadLocalRandom

- java.util.Random 은 멀티 스레드 환경에서 `CompareAndSet(CAS)`로 인해 실패할 가능성이 있어 성능이 좋지 않음
- Random 대신 ThreadLocalRandom 을 사용하면 해당 스레드 전용 random 이라 간섭이 발생하지 않음